{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ problem.title }}</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #e0f7fa, #e8f0fe);
      padding-bottom: 40px;
    }

    /* Problem Title */
    .problem-header {
      margin-top: 20px;
      margin-bottom: 20px;
    }
    .problem-header h1 {
      background: linear-gradient(90deg, #2196f3, #00bcd4);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 800;
    }

    /* Problem Statement Box */
    .problem-statement {
      background: #ffffff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      border-left: 6px solid #2196f3;
      white-space: pre-wrap;
    }

    /* Code Editor & Inputs */
    textarea, textarea.form-control {
      font-family: monospace;
      font-size: 14px;
      border-radius: 8px;
      background: #fefefe;
    }
    textarea#id_source_code {
      height: 400px; /* Full coding area */
    }

    /* Buttons */
    .btn-run {
      background: linear-gradient(90deg, #6c757d, #495057);
      color: white;
      border-radius: 8px;
      padding: 10px 20px;
      font-weight: bold;
      border: none;
      transition: transform 0.2s ease;
    }
    .btn-run:hover {
      transform: translateY(-2px);
    }
    .btn-submit {
      background: linear-gradient(90deg, #198754, #0d6efd);
      color: white;
      border-radius: 8px;
      padding: 10px 20px;
      font-weight: bold;
      border: none;
      transition: transform 0.2s ease;
    }
    .btn-submit:hover {
      transform: translateY(-2px);
    }

    /* Result & Output */
    pre {
      padding: 12px;
      border-radius: 6px;
      white-space: pre-wrap;
    }
    .result-card {
      border-left: 6px solid #0dcaf0;
      background: #f1fafe;
    }
    .output-card {
      border-left: 6px solid #28a745;
      background: #f0fff4;
    }

    /* AI Review */
    .ai-card pre {
      background: #f8f9fa;
      border-radius: 6px;
      padding: 10px;
    }
  </style>
</head>
<body>

<div class="container mt-4">
  
  <!-- Problem Title -->
  <div class="problem-header text-center">
    <h1>{{ problem.title }}</h1>
  </div>

  <!-- Problem Statement -->
  <div class="problem-statement mb-4">
    <p>{{ problem.statement }}</p>
  </div>

  <!-- Submission Form -->
  <div class="card p-4 mb-4 shadow-sm">
    <h3 class="mb-3 text-primary">Submit Your Solution</h3>
    <form method="post">
      {% csrf_token %}
      
      <!-- Code Editor -->
      <div class="editor-container">
      {{ form.as_p }}

      <p class="text-muted fst-italic mt-2">
      <strong>Note for Java users:</strong> Please write your code inside the <code>main</code> function, and the class name should be <code>Main</code>. The Java program execution starts from the <code>main</code> method.
      </p>
      </div>

      <!-- Custom Input -->
      <div class="mb-3">
        <label for="custom_input" class="form-label fw-bold text-secondary">Custom Input (optional):</label>
        <textarea name="custom_input" id="custom_input" rows="4" class="form-control">{{ custom_input|default_if_none:"" }}</textarea>
      </div>

      <!-- Buttons -->
      <div class="d-flex gap-2">
        <button type="submit" name="run_code" class="btn-run">‚ñ∂ Run Code</button>
        <button type="submit" name="submit_code" class="btn-submit">‚úÖ Submit</button>
      </div>
    </form>
  </div>

  <!-- Execution Result -->
  {% if result_message %}
    <div class="card p-3 mb-4 result-card">
      <h3 class="fw-bold text-info">Result:</h3>
      <pre>{{ result_message }}</pre>
    </div>
  {% endif %}

  {% if output_data %}
    <div class="card p-3 mb-4 output-card">
      <h3 class="fw-bold text-success">Output:</h3>
      <pre>{{ output_data }}</pre>
    </div>
  {% endif %}

  <!-- AI Review -->
  {% if show_review and not ai_review %}
    <form method="get" class="mb-4">
      <input type="hidden" name="ai_review" value="1">
      <input type="hidden" name="submission_id" value="{{ submission_id }}">
      <button type="submit" class="btn btn-primary">üîç Get AI Review</button>
    </form>
  {% endif %}

  {% if ai_review %}
    <div class="card ai-card mt-4 shadow-sm">
      <div class="card-header bg-primary text-white fw-bold">
        üîç AI Review
      </div>
      <div class="card-body">
        <pre>{{ ai_review }}</pre>
      </div>
    </div>
  {% endif %}

</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
